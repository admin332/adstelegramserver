

# –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ: –¥–æ–±–∞–≤–∏—Ç—å —Å—Å—ã–ª–∫—É –Ω–∞ —Ç–æ–≤–∞—Ä –≤ –±—Ä–∏—Ñ –¥–ª—è prompt –∫–∞–º–ø–∞–Ω–∏–π

## –ü—Ä–æ–±–ª–µ–º–∞

–ü—Ä–∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–∏ –≤–ª–∞–¥–µ–ª—å—Ü–∞ –∫–∞–Ω–∞–ª–∞ –æ **prompt** –∫–∞–º–ø–∞–Ω–∏–∏ –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è —Å—Å—ã–ª–∫–∞ –Ω–∞ —Ç–æ–≤–∞—Ä (Product Link), –∫–æ—Ç–æ—Ä—É—é —Ä–µ–∫–ª–∞–º–æ–¥–∞—Ç–µ–ª—å –¥–æ–±–∞–≤–∏–ª –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–∞–º–ø–∞–Ω–∏–∏.

**–ü—Ä–∏—á–∏–Ω–∞:** –í `check-escrow-payments` —É—Å–ª–æ–≤–∏–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç `button_text && button_url`, –Ω–æ –¥–ª—è prompt –∫–∞–º–ø–∞–Ω–∏–π `button_text` –Ω–µ –∑–∞–ø–æ–ª–Ω—è–µ—Ç—Å—è ‚Äî —Ç–æ–ª—å–∫–æ `button_url`.

## –°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –∫–æ–¥–∞

| –§–∞–π–ª | –£—Å–ª–æ–≤–∏–µ | –†–µ–∑—É–ª—å—Ç–∞—Ç |
|------|---------|-----------|
| `notify-deal-payment` | `if (button_url)` | ‚úÖ –°—Å—ã–ª–∫–∞ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è |
| `check-escrow-payments` | `button_text && button_url` | ‚ùå –°—Å—ã–ª–∫–∞ –ù–ï –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è |

## –†–µ—à–µ–Ω–∏–µ

–ò—Å–ø—Ä–∞–≤–∏—Ç—å —É—Å–ª–æ–≤–∏–µ –≤ `check-escrow-payments` –¥–ª—è prompt –∫–∞–º–ø–∞–Ω–∏–π ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Å—ã–ª–∫—É –¥–∞–∂–µ –±–µ–∑ —Ç–µ–∫—Å—Ç–∞ –∫–Ω–æ–ø–∫–∏.

## –ò–∑–º–µ–Ω–µ–Ω–∏—è

### –§–∞–π–ª: `supabase/functions/check-escrow-payments/index.ts`

–ó–∞–º–µ–Ω–∏—Ç—å —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –±—Ä–∏—Ñ–∞ (—Å—Ç—Ä–æ–∫–∏ 266-271):

**–ë—ã–ª–æ:**
```typescript
const briefText = `üìã <b>–ë—Ä–∏—Ñ –æ—Ç —Ä–µ–∫–ª–∞–º–æ–¥–∞—Ç–µ–ª—è:</b>

${deal.campaign?.text || "–ë—Ä–∏—Ñ –Ω–µ —É–∫–∞–∑–∞–Ω"}${deal.campaign?.button_text && deal.campaign?.button_url ? `

üîó –ö–Ω–æ–ø–∫–∞: <b>${deal.campaign.button_text}</b>
–°—Å—ã–ª–∫–∞: ${deal.campaign.button_url}` : ""}`;
```

**–°—Ç–∞–Ω–µ—Ç:**
```typescript
let briefText = `üìã <b>–ë—Ä–∏—Ñ –æ—Ç —Ä–µ–∫–ª–∞–º–æ–¥–∞—Ç–µ–ª—è:</b>

${deal.campaign?.text || "–ë—Ä–∏—Ñ –Ω–µ —É–∫–∞–∑–∞–Ω"}`;

// –î–ª—è prompt –∫–∞–º–ø–∞–Ω–∏–π - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ —Ç–æ–≤–∞—Ä (Product Link)
if (deal.campaign?.button_url) {
  if (deal.campaign?.button_text) {
    // –ï—Å—Ç—å –∏ —Ç–µ–∫—Å—Ç –∫–Ω–æ–ø–∫–∏ –∏ —Å—Å—ã–ª–∫–∞ (ready_post)
    briefText += `\n\nüîó –ö–Ω–æ–ø–∫–∞: <b>${deal.campaign.button_text}</b>\n–°—Å—ã–ª–∫–∞: ${deal.campaign.button_url}`;
  } else {
    // –¢–æ–ª—å–∫–æ —Å—Å—ã–ª–∫–∞ (prompt –∫–∞–º–ø–∞–Ω–∏—è - Product Link)
    briefText += `\n\nüîó <b>–°—Å—ã–ª–∫–∞ –Ω–∞ —Ç–æ–≤–∞—Ä:</b> ${deal.campaign.button_url}`;
  }
}
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç

**–°–æ–æ–±—â–µ–Ω–∏–µ –≤–ª–∞–¥–µ–ª—å—Ü—É –∫–∞–Ω–∞–ª–∞ –¥–ª—è prompt –∫–∞–º–ø–∞–Ω–∏–∏:**
```
üìã –ë—Ä–∏—Ñ –æ—Ç —Ä–µ–∫–ª–∞–º–æ–¥–∞—Ç–µ–ª—è:

[–¢–µ–∫—Å—Ç –±—Ä–∏—Ñ–∞]

üîó –°—Å—ã–ª–∫–∞ –Ω–∞ —Ç–æ–≤–∞—Ä: https://example.com/product
```

## –§–∞–π–ª—ã –∫ –∏–∑–º–µ–Ω–µ–Ω–∏—é

| –§–∞–π–ª | –ò–∑–º–µ–Ω–µ–Ω–∏–µ |
|------|-----------|
| `supabase/functions/check-escrow-payments/index.ts` | –ò—Å–ø—Ä–∞–≤–∏—Ç—å —É—Å–ª–æ–≤–∏–µ –ø–æ–∫–∞–∑–∞ —Å—Å—ã–ª–∫–∏ –≤ –±—Ä–∏—Ñ–µ |

