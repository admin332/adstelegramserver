

## Ğ¦ĞµĞ»ÑŒ
Ğ ĞµĞ°Ğ»Ğ¸Ğ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ»Ğ½ÑƒÑ Ğ¸Ğ½Ñ‚ĞµĞ³Ñ€Ğ°Ñ†Ğ¸Ñ Ñ TON ĞºĞ¾ÑˆĞµĞ»ÑŒĞºĞ°Ğ¼Ğ¸:
1. **ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ğµ ĞºĞ¾ÑˆĞµĞ»ÑŒĞºĞ° Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ** Ñ‡ĞµÑ€ĞµĞ· TON Connect Ğ² Ğ¿Ñ€Ğ¾Ñ„Ğ¸Ğ»Ğµ
2. **Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ ÑÑĞºÑ€Ğ¾Ñƒ-ĞºĞ¾ÑˆĞµĞ»ÑŒĞºĞ¾Ğ²** Ğ´Ğ»Ñ ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¹ ÑĞ´ĞµĞ»ĞºĞ¸
3. **ĞÑ„Ğ¾Ñ€Ğ¼Ğ»ĞµĞ½Ğ¸Ğµ Ğ·Ğ°ĞºĞ°Ğ·Ğ°** Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¾Ğ¹ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡Ñ‘Ğ½Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ¾ÑˆĞµĞ»ÑŒĞºĞ°

## ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ° Ñ€ĞµÑˆĞµĞ½Ğ¸Ñ

```text
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FRONTEND                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   TonConnect    â”‚    â”‚   Profile       â”‚    â”‚  OrderDrawer    â”‚  â”‚
â”‚  â”‚   Provider      â”‚â”€â”€â”€â–ºâ”‚   Wallet Card   â”‚    â”‚  + Payment Step â”‚  â”‚
â”‚  â”‚   (App.tsx)     â”‚    â”‚                 â”‚    â”‚                 â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                  â”‚                      â”‚           â”‚
â”‚                                  â–¼                      â–¼           â”‚
â”‚                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚                         â”‚      useTonWallet Hook          â”‚         â”‚
â”‚                         â”‚  - address                      â”‚         â”‚
â”‚                         â”‚  - isConnected                  â”‚         â”‚
â”‚                         â”‚  - connect/disconnect           â”‚         â”‚
â”‚                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                          â”‚                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         BACKEND (Edge Functions)                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ save-wallet     â”‚    â”‚ create-deal     â”‚    â”‚ generate-escrow â”‚  â”‚
â”‚  â”‚                 â”‚    â”‚                 â”‚â”€â”€â”€â–ºâ”‚                 â”‚  â”‚
â”‚  â”‚ Saves address   â”‚    â”‚ Creates deal    â”‚    â”‚ mnemonicNew()   â”‚  â”‚
â”‚  â”‚ to users table  â”‚    â”‚ with escrow     â”‚    â”‚ WalletContractV4â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                           â”‚
                                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         DATABASE                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                      â”‚
â”‚  users                              deals                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ id                  â”‚           â”‚ id                          â”‚  â”‚
â”‚  â”‚ telegram_id         â”‚           â”‚ advertiser_id               â”‚  â”‚
â”‚  â”‚ wallet_address [NEW]â”‚           â”‚ channel_id                  â”‚  â”‚
â”‚  â”‚ ...                 â”‚           â”‚ escrow_address [NEW]        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚ escrow_mnemonic [NEW]       â”‚  â”‚
â”‚                                    â”‚ escrow_status [NEW]         â”‚  â”‚
â”‚                                    â”‚ ...                         â”‚  â”‚
â”‚                                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## Ğ­Ñ‚Ğ°Ğ¿Ñ‹ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

### Ğ­Ñ‚Ğ°Ğ¿ 1: Ğ£ÑÑ‚Ğ°Ğ½Ğ¾Ğ²ĞºĞ° Ğ·Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚ĞµĞ¹

Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ TON Connect Ğ±Ğ¸Ğ±Ğ»Ğ¸Ğ¾Ñ‚ĞµĞºĞ¸:
```json
{
  "@tonconnect/ui-react": "^2.0.6"
}
```

### Ğ­Ñ‚Ğ°Ğ¿ 2: ĞœĞ¸Ğ³Ñ€Ğ°Ñ†Ğ¸Ñ Ğ±Ğ°Ğ·Ñ‹ Ğ´Ğ°Ğ½Ğ½Ñ‹Ñ…

#### 2.1 Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ `wallet_address` Ğ² Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ `users`

```sql
ALTER TABLE public.users
ADD COLUMN IF NOT EXISTS wallet_address TEXT;
```

#### 2.2 Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ Ğ¿Ğ¾Ğ»Ñ ÑÑĞºÑ€Ğ¾Ñƒ Ğ² Ñ‚Ğ°Ğ±Ğ»Ğ¸Ñ†Ñƒ `deals`

```sql
-- Ğ­ÑĞºÑ€Ğ¾Ñƒ Ğ¿Ğ¾Ğ»Ñ Ğ´Ğ»Ñ ÑĞ´ĞµĞ»Ğ¾Ğº
ALTER TABLE public.deals
ADD COLUMN IF NOT EXISTS escrow_address TEXT,
ADD COLUMN IF NOT EXISTS escrow_mnemonic_encrypted TEXT,
ADD COLUMN IF NOT EXISTS escrow_balance NUMERIC DEFAULT 0,
ADD COLUMN IF NOT EXISTS payment_verified_at TIMESTAMPTZ;
```

### Ğ­Ñ‚Ğ°Ğ¿ 3: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ğ¼Ğ°Ğ½Ğ¸Ñ„ĞµÑÑ‚ TON Connect

**Ğ¤Ğ°Ğ¹Ğ»**: `public/tonconnect-manifest.json`

```json
{
  "url": "https://adstelegramserver.lovable.app",
  "name": "Adsingo",
  "iconUrl": "https://adstelegramserver.lovable.app/favicon.ico",
  "termsOfUseUrl": "https://adstelegramserver.lovable.app/terms",
  "privacyPolicyUrl": "https://adstelegramserver.lovable.app/privacy"
}
```

### Ğ­Ñ‚Ğ°Ğ¿ 4: ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ TonConnectUIProvider

**Ğ¤Ğ°Ğ¹Ğ»**: `src/main.tsx`

```tsx
import { TonConnectUIProvider } from '@tonconnect/ui-react';

const manifestUrl = `${window.location.origin}/tonconnect-manifest.json`;

createRoot(document.getElementById("root")!).render(
  <TonConnectUIProvider manifestUrl={manifestUrl}>
    <App />
  </TonConnectUIProvider>
);
```

### Ğ­Ñ‚Ğ°Ğ¿ 5: Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ Ñ…ÑƒĞº `useTonWallet`

**Ğ¤Ğ°Ğ¹Ğ»**: `src/hooks/useTonWallet.ts`

Ğ¥ÑƒĞº Ğ¸Ğ½ĞºĞ°Ğ¿ÑÑƒĞ»Ğ¸Ñ€ÑƒĞµÑ‚ Ñ€Ğ°Ğ±Ğ¾Ñ‚Ñƒ Ñ TON Connect:
- `address` - Ñ‚ĞµĞºÑƒÑ‰Ğ¸Ğ¹ Ğ°Ğ´Ñ€ĞµÑ ĞºĞ¾ÑˆĞµĞ»ÑŒĞºĞ°
- `isConnected` - ÑÑ‚Ğ°Ñ‚ÑƒÑ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ
- `connect()` - Ğ¾Ñ‚ĞºÑ€Ñ‹Ñ‚ÑŒ Ğ¼Ğ¾Ğ´Ğ°Ğ»ĞºÑƒ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ
- `disconnect()` - Ğ¾Ñ‚ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ ĞºĞ¾ÑˆĞµĞ»Ñ‘Ğº
- `saveToDatabase()` - ÑĞ¾Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ÑŒ Ğ°Ğ´Ñ€ĞµÑ Ğ² Ğ‘Ğ”

```tsx
import { useTonAddress, useTonConnectModal, useTonConnectUI } from '@tonconnect/ui-react';
import { useCallback } from 'react';
import { supabase } from '@/integrations/supabase/client';
import { useAuth } from '@/contexts/AuthContext';

export function useTonWallet() {
  const address = useTonAddress();
  const { open } = useTonConnectModal();
  const [tonConnectUI] = useTonConnectUI();
  const { user } = useAuth();

  const saveToDatabase = useCallback(async (walletAddress: string) => {
    if (!user?.id) return;
    
    const { error } = await supabase.functions.invoke('save-wallet', {
      body: { 
        walletAddress,
        initData: window.Telegram?.WebApp?.initData 
      }
    });
    
    if (error) console.error('Error saving wallet:', error);
  }, [user?.id]);

  return {
    address,
    isConnected: !!address,
    connect: open,
    disconnect: () => tonConnectUI.disconnect(),
    saveToDatabase,
  };
}
```

### Ğ­Ñ‚Ğ°Ğ¿ 6: ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ Profile.tsx

Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑĞµĞºÑ†Ğ¸Ñ "ĞšĞ¾ÑˆĞµĞ»Ñ‘Ğº" Ñ ĞºĞ½Ğ¾Ğ¿ĞºĞ¾Ğ¹ TON Connect:

```tsx
import { TonConnectButton } from '@tonconnect/ui-react';
import { useTonWallet } from '@/hooks/useTonWallet';

// Ğ’Ğ½ÑƒÑ‚Ñ€Ğ¸ ĞºĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ğ°:
const { address, isConnected, saveToDatabase } = useTonWallet();

// ĞŸÑ€Ğ¸ Ğ¸Ğ·Ğ¼ĞµĞ½ĞµĞ½Ğ¸Ğ¸ Ğ°Ğ´Ñ€ĞµÑĞ° - ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµĞ¼ Ğ² Ğ‘Ğ”
useEffect(() => {
  if (address) {
    saveToDatabase(address);
  }
}, [address, saveToDatabase]);

// Ğ’ UI - ÑĞµĞºÑ†Ğ¸Ñ ĞºĞ¾ÑˆĞµĞ»ÑŒĞºĞ°:
<div className="bg-card rounded-2xl p-5">
  <h3 className="text-lg font-semibold mb-4">TON ĞšĞ¾ÑˆĞµĞ»Ñ‘Ğº</h3>
  
  {isConnected ? (
    <div className="flex items-center justify-between">
      <div>
        <p className="text-sm text-muted-foreground">ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡Ñ‘Ğ½</p>
        <p className="font-mono text-sm">{address?.slice(0, 8)}...{address?.slice(-6)}</p>
      </div>
      <TonConnectButton />
    </div>
  ) : (
    <TonConnectButton className="w-full" />
  )}
</div>
```

### Ğ­Ñ‚Ğ°Ğ¿ 7: ĞĞ±Ğ½Ğ¾Ğ²Ğ¸Ñ‚ÑŒ OrderDrawer

Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ **4-Ğ¹ ÑˆĞ°Ğ³** - Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ğ°:

```tsx
// Ğ¨Ğ°Ğ³ 4: ĞŸĞ¾Ğ´Ñ‚Ğ²ĞµÑ€Ğ¶Ğ´ĞµĞ½Ğ¸Ğµ Ğ¸ Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ğ°
{currentStep === 4 && (
  <PaymentStep
    totalPrice={quantity * pricePerPost}
    escrowAddress={escrowAddress}
    onPaymentComplete={handlePaymentComplete}
  />
)}
```

ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚ `PaymentStep`:
- ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ Ğ¸Ñ‚Ğ¾Ğ³Ğ¾Ğ²ÑƒÑ ÑÑƒĞ¼Ğ¼Ñƒ
- ĞŸĞ¾ĞºĞ°Ğ·Ñ‹Ğ²Ğ°ĞµÑ‚ ÑÑĞºÑ€Ğ¾Ñƒ-Ğ°Ğ´Ñ€ĞµÑ Ğ´Ğ»Ñ Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ñ‹
- QR-ĞºĞ¾Ğ´ Ğ´Ğ»Ñ ÑĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ
- ĞšĞ½Ğ¾Ğ¿ĞºĞ° "ĞĞ¿Ğ»Ğ°Ñ‚Ğ¸Ñ‚ÑŒ Ñ‡ĞµÑ€ĞµĞ· ĞºĞ¾ÑˆĞµĞ»Ñ‘Ğº"
- Ğ¡ÑÑ‹Ğ»ĞºĞ° Ğ½Ğ° ÑĞºÑĞ¿Ğ»Ğ¾Ñ€ĞµÑ€ Ğ´Ğ»Ñ Ğ¿Ñ€Ğ¾Ğ²ĞµÑ€ĞºĞ¸

### Ğ­Ñ‚Ğ°Ğ¿ 8: Edge Function Ğ´Ğ»Ñ ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ñ ĞºĞ¾ÑˆĞµĞ»ÑŒĞºĞ°

**Ğ¤Ğ°Ğ¹Ğ»**: `supabase/functions/save-wallet/index.ts`

```typescript
import { serve } from "https://deno.land/std@0.168.0/http/server.ts";
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

// Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Telegram initData + ÑĞ¾Ñ…Ñ€Ğ°Ğ½ĞµĞ½Ğ¸Ğµ wallet_address
serve(async (req) => {
  // 1. Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ initData
  // 2. ĞŸĞ¾Ğ»ÑƒÑ‡ĞµĞ½Ğ¸Ğµ user_id Ğ¿Ğ¾ telegram_id
  // 3. UPDATE users SET wallet_address = ? WHERE id = ?
});
```

### Ğ­Ñ‚Ğ°Ğ¿ 9: Edge Function Ğ´Ğ»Ñ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ ÑĞ´ĞµĞ»ĞºĞ¸

**Ğ¤Ğ°Ğ¹Ğ»**: `supabase/functions/create-deal/index.ts`

```typescript
import { mnemonicNew, mnemonicToWalletKey } from "npm:@ton/crypto";
import { WalletContractV4 } from "npm:@ton/ton";

async function generateEscrowWallet() {
  const mnemonic = await mnemonicNew();
  const keyPair = await mnemonicToWalletKey(mnemonic);
  const wallet = WalletContractV4.create({ 
    publicKey: keyPair.publicKey, 
    workchain: 0 
  });
  
  return {
    address: wallet.address.toString(),
    mnemonic: mnemonic.join(" "),
  };
}

serve(async (req) => {
  // 1. Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ initData
  // 2. ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡Ñ‘Ğ½Ğ½Ğ¾Ğ³Ğ¾ ĞºĞ¾ÑˆĞµĞ»ÑŒĞºĞ°
  // 3. Ğ“ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ ÑÑĞºÑ€Ğ¾Ñƒ-ĞºĞ¾ÑˆĞµĞ»ÑŒĞºĞ°
  // 4. Ğ¨Ğ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ Ğ¼Ğ½ĞµĞ¼Ğ¾Ğ½Ğ¸ĞºĞ¸ (AES-256)
  // 5. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ Ğ·Ğ°Ğ¿Ğ¸ÑĞ¸ Ğ² deals
  // 6. Ğ’Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‚ escrow_address ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ñƒ
});
```

### Ğ­Ñ‚Ğ°Ğ¿ 10: Ğ¡ĞµĞºÑ€ĞµÑ‚ Ğ´Ğ»Ñ ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ

Ğ”Ğ¾Ğ±Ğ°Ğ²Ğ¸Ñ‚ÑŒ ÑĞµĞºÑ€ĞµÑ‚ `ENCRYPTION_KEY` Ğ² Supabase Ğ´Ğ»Ñ ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¼Ğ½ĞµĞ¼Ğ¾Ğ½Ğ¸Ğº:
- 256-Ğ±Ğ¸Ñ‚Ğ½Ñ‹Ğ¹ ĞºĞ»ÑÑ‡ Ğ´Ğ»Ñ AES-256-GCM
- Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ÑÑ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ½Ğ° Ğ±ÑĞºĞµĞ½Ğ´Ğµ
- ĞœĞ½ĞµĞ¼Ğ¾Ğ½Ğ¸ĞºĞ° Ñ€Ğ°ÑÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ñ‹Ğ²Ğ°ĞµÑ‚ÑÑ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ¿Ñ€Ğ¸ Ğ²Ñ‹Ğ²Ğ¾Ğ´Ğµ ÑÑ€ĞµĞ´ÑÑ‚Ğ²

## Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ

1. **ĞœĞ½ĞµĞ¼Ğ¾Ğ½Ğ¸ĞºĞ¸ Ñ…Ñ€Ğ°Ğ½ÑÑ‚ÑÑ Ğ·Ğ°ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ñ‹Ğ¼Ğ¸** - AES-256-GCM
2. **ĞšĞ»ÑÑ‡ ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ Ğ² ÑĞµĞºÑ€ĞµÑ‚Ğ°Ñ…** - Ğ½ĞµĞ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ñƒ
3. **Ğ’Ğ°Ğ»Ğ¸Ğ´Ğ°Ñ†Ğ¸Ñ Telegram initData** - Ğ½ĞµĞ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ Ğ¿Ğ¾Ğ´Ğ´ĞµĞ»Ğ°Ñ‚ÑŒ Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ñ
4. **RLS Ğ½Ğ° deals** - Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸ Ğ²Ğ¸Ğ´ÑÑ‚ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ÑĞ²Ğ¾Ğ¸ ÑĞ´ĞµĞ»ĞºĞ¸
5. **escrow_mnemonic_encrypted ÑĞºÑ€Ñ‹Ñ‚ Ğ¾Ñ‚ RLS** - SELECT Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ Ğ´Ğ»Ñ service role

## Ğ¢ĞµÑ…Ğ½Ğ¸Ñ‡ĞµÑĞºĞ¸Ğµ Ğ´ĞµÑ‚Ğ°Ğ»Ğ¸

### Ğ—Ğ°Ğ²Ğ¸ÑĞ¸Ğ¼Ğ¾ÑÑ‚Ğ¸ Ğ´Ğ»Ñ Edge Functions
- `npm:@ton/crypto` - Ğ³ĞµĞ½ĞµÑ€Ğ°Ñ†Ğ¸Ñ Ğ¼Ğ½ĞµĞ¼Ğ¾Ğ½Ğ¸Ğº Ğ¸ ĞºĞ»ÑÑ‡ĞµĞ¹
- `npm:@ton/ton` - ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ğµ ĞºĞ¾ÑˆĞµĞ»ÑŒĞºĞ¾Ğ²

### RLS Ğ´Ğ»Ñ Ğ½Ğ¾Ğ²Ñ‹Ñ… Ğ¿Ğ¾Ğ»ĞµĞ¹
```sql
-- ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»Ğ¸ Ğ¼Ğ¾Ğ³ÑƒÑ‚ Ğ²Ğ¸Ğ´ĞµÑ‚ÑŒ ÑĞ²Ğ¾Ğ¹ wallet_address
-- escrow_mnemonic_encrypted ĞĞ˜ĞšĞĞ“Ğ”Ğ Ğ½Ğµ Ğ²Ğ¾Ğ·Ğ²Ñ€Ğ°Ñ‰Ğ°ĞµÑ‚ÑÑ ĞºĞ»Ğ¸ĞµĞ½Ñ‚Ñƒ
-- escrow_address Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ĞµĞ½ Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ¾Ğ±Ñ€Ğ°Ğ¶ĞµĞ½Ğ¸Ñ
```

## Ğ ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚

ĞŸĞ¾ÑĞ»Ğµ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸:
1. **ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ**: ĞºĞ½Ğ¾Ğ¿ĞºĞ° "ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ ĞºĞ¾ÑˆĞµĞ»Ñ‘Ğº" ÑĞ¾Ñ…Ñ€Ğ°Ğ½ÑĞµÑ‚ Ğ°Ğ´Ñ€ĞµÑ Ğ² Ğ‘Ğ”
2. **OrderDrawer**: 4 ÑˆĞ°Ğ³Ğ° Ğ²Ğ¼ĞµÑÑ‚Ğ¾ 3, Ğ¿Ğ¾ÑĞ»ĞµĞ´Ğ½Ğ¸Ğ¹ - Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ğ°
3. **Ğ¡Ğ´ĞµĞ»ĞºĞ°**: Ğ³ĞµĞ½ĞµÑ€Ğ¸Ñ€ÑƒĞµÑ‚ÑÑ ÑƒĞ½Ğ¸ĞºĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ ÑÑĞºÑ€Ğ¾Ñƒ-Ğ°Ğ´Ñ€ĞµÑ
4. **ĞŸĞ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ĞµĞ»ÑŒ Ğ²Ğ¸Ğ´Ğ¸Ñ‚**: "ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ÑŒÑ‚Ğµ 5 TON Ğ½Ğ° Ğ°Ğ´Ñ€ĞµÑ EQ...abc"
5. **Ğ‘ÑĞºĞµĞ½Ğ´**: Ñ…Ñ€Ğ°Ğ½Ğ¸Ñ‚ Ğ·Ğ°ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½ÑƒÑ Ğ¼Ğ½ĞµĞ¼Ğ¾Ğ½Ğ¸ĞºÑƒ Ğ´Ğ»Ñ Ğ²Ñ‹Ğ²Ğ¾Ğ´Ğ° Ğ¿Ğ¾ÑĞ»Ğµ Ğ·Ğ°Ğ²ĞµÑ€ÑˆĞµĞ½Ğ¸Ñ

## Ğ’Ğ¸Ğ·ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚

### ĞŸÑ€Ğ¾Ñ„Ğ¸Ğ»ÑŒ - Ğ¡ĞµĞºÑ†Ğ¸Ñ ĞºĞ¾ÑˆĞµĞ»ÑŒĞºĞ°

Ğ”Ğ¾:
```
ĞšĞ¾ÑˆĞµĞ»Ñ‘Ğº      $1,250.00  >
```

ĞŸĞ¾ÑĞ»Ğµ:
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  TON ĞšĞ¾ÑˆĞµĞ»Ñ‘Ğº                â”‚
â”‚                             â”‚
â”‚  ĞŸĞ¾Ğ´ĞºĞ»ÑÑ‡Ñ‘Ğ½                  â”‚
â”‚  UQC7...x4Kw                â”‚
â”‚                             â”‚
â”‚  [ĞÑ‚ĞºĞ»ÑÑ‡Ğ¸Ñ‚ÑŒ]                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### OrderDrawer - ĞĞ¾Ğ²Ñ‹Ğ¹ ÑˆĞ°Ğ³ Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ñ‹

```
Ğ¨Ğ°Ğ³ 4 Ğ¸Ğ· 4: ĞĞ¿Ğ»Ğ°Ñ‚Ğ°

Ğš Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ğµ: 5 TON (~$17.50)

ĞÑ‚Ğ¿Ñ€Ğ°Ğ²ÑŒÑ‚Ğµ ÑÑ€ĞµĞ´ÑÑ‚Ğ²Ğ° Ğ½Ğ° Ğ°Ğ´Ñ€ĞµÑ ÑÑĞºÑ€Ğ¾Ñƒ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  EQC7xN...8kM4              â”‚
â”‚  [ğŸ“‹ ĞšĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ñ‚ÑŒ]            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[QR-ĞºĞ¾Ğ´ Ğ´Ğ»Ñ ÑĞºĞ°Ğ½Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ]

ĞŸĞ¾ÑĞ»Ğµ Ğ¾Ğ¿Ğ»Ğ°Ñ‚Ñ‹ ÑÑ€ĞµĞ´ÑÑ‚Ğ²Ğ° Ğ±ÑƒĞ´ÑƒÑ‚
Ğ·Ğ°Ğ¼Ğ¾Ñ€Ğ¾Ğ¶ĞµĞ½Ñ‹ Ğ´Ğ¾ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ Ğ·Ğ°ĞºĞ°Ğ·Ğ°.

[ğŸ”— ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ñ‚ÑŒ Ğ² ÑĞºÑĞ¿Ğ»Ğ¾Ñ€ĞµÑ€Ğµ]

[ĞĞ¿Ğ»Ğ°Ñ‚Ğ¸Ñ‚ÑŒ Ñ‡ĞµÑ€ĞµĞ· ĞºĞ¾ÑˆĞµĞ»Ñ‘Ğº]
```
