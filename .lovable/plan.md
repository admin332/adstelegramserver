

## План: Управление каналами и кампаниями на странице /create

### Текущее поведение

Сейчас после создания канала или кампании пользователь перенаправляется на другие страницы (`/channels` или `/deals`). Нужно вместо этого показывать список созданных элементов прямо на странице `/create`.

### Новая архитектура

```text
/create
├── Шаг 1: Выбор роли (рекламодатель / владелец канала)
│
├── Рекламодатель выбран:
│   ├── Есть кампании? → Показать "Мои кампании" + кнопка "Добавить новую"
│   └── Нет кампаний? → Показать форму создания кампании
│
└── Владелец канала выбран:
    ├── Есть каналы? → Показать "Мои каналы" + кнопка "Добавить новый"
    └── Нет каналов? → Показать мастер добавления канала
```

### Новые компоненты

#### 1. MyChannelsList.tsx

Показывает список каналов пользователя:
- Карточка канала с аватаром, названием, подписчиками
- Переключатель активности (is_active)
- Кнопка "Добавить канал"

#### 2. MyCampaignsList.tsx

Показывает список кампаний пользователя:
- Карточка кампании с превью, названием, текстом
- Кнопки: Редактировать, Удалить
- Переключатель активности
- Кнопка "Создать кампанию"

### Новые хуки

#### 3. useUserChannels.ts

```typescript
// Получение каналов текущего пользователя
const { data, isLoading, refetch } = useUserChannels();

// Переключение активности
const toggleActive = useToggleChannelActive();
```

#### 4. useUserCampaigns.ts

```typescript
// Получение кампаний текущего пользователя
const { data, isLoading, refetch } = useUserCampaigns();

// Удаление кампании
const deleteCampaign = useDeleteCampaign();

// Переключение активности
const toggleActive = useToggleCampaignActive();
```

### Изменения в базе данных

Необходимо добавить RLS политики для доступа к своим каналам и кампаниям:

```sql
-- Владельцы могут видеть свои каналы
CREATE POLICY "Owners can view own channels"
ON public.channels FOR SELECT
USING (owner_id = auth.uid() OR (is_active = true AND verified = true));

-- Владельцы могут обновлять свои каналы  
CREATE POLICY "Owners can update own channels"
ON public.channels FOR UPDATE
USING (owner_id = auth.uid());

-- Владельцы могут видеть свои кампании
CREATE POLICY "Owners can view own campaigns"
ON public.campaigns FOR SELECT
USING (owner_id = auth.uid() OR is_active = true);

-- Владельцы могут обновлять свои кампании
CREATE POLICY "Owners can update own campaigns"
ON public.campaigns FOR UPDATE
USING (owner_id = auth.uid());

-- Владельцы могут удалять свои кампании
CREATE POLICY "Owners can delete own campaigns"
ON public.campaigns FOR DELETE
USING (owner_id = auth.uid());
```

### Изменения в Create.tsx

| Состояние | Логика |
|-----------|--------|
| `step: "role"` | Выбор роли (как сейчас) |
| `step: "list"` | Показать MyChannelsList или MyCampaignsList |
| `step: "form"` | Показать AddChannelWizard или CreateCampaignForm |

При первом входе:
- Проверяем есть ли у пользователя каналы/кампании
- Если есть — показываем список
- Если нет — показываем форму создания

### UI карточки канала в списке

```text
┌─────────────────────────────────────────────┐
│ [Avatar] Название канала          [Switch] │
│          @username                          │
│          12.5K подписчиков                  │
│          ✓ Верифицирован                    │
└─────────────────────────────────────────────┘
```

### UI карточки кампании в списке

```text
┌─────────────────────────────────────────────┐
│ [Preview] Название кампании       [Switch] │
│           Текст рекламы...                  │
│           ┌────────────────────┐            │
│           │ [Edit]    [Delete] │            │
│           └────────────────────┘            │
└─────────────────────────────────────────────┘
```

### Файлы для создания/изменения

| Файл | Действие |
|------|----------|
| `src/hooks/useUserChannels.ts` | Создать — хук для каналов пользователя |
| `src/hooks/useUserCampaigns.ts` | Создать — хук для кампаний пользователя |
| `src/components/create/MyChannelsList.tsx` | Создать — список каналов |
| `src/components/create/MyCampaignsList.tsx` | Создать — список кампаний |
| `src/pages/Create.tsx` | Изменить — добавить шаг "list" и логику переключения |

### Логика отображения

1. Пользователь выбирает роль
2. Загружаем данные (каналы или кампании)
3. Если данные есть → показываем список с кнопкой "Добавить"
4. Если данных нет → сразу показываем форму создания
5. После успешного создания → возвращаемся к списку

### Результат

- Владелец канала видит все свои каналы с возможностью включить/выключить
- Рекламодатель видит все свои кампании с возможностью редактировать/удалить
- Удобная навигация между списком и формой создания
- Данные загружаются из базы по `owner_id`

