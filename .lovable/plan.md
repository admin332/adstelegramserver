

## ะะปะฐะฝ: ะัะฟัะฐะฒะธัั ะพัะฟัะฐะฒะบั ัะพัะพ/ะฒะธะดะตะพ ะฒ ะฟัะตะฒัั ะธ ัะฑัะฐัั ะทะฐะณะพะปะพะฒะพะบ

### ะะฑะฝะฐััะถะตะฝะฝัะต ะฟัะพะฑะปะตะผั

1. **Storage bucket `campaign-images` ะฝะต ัััะตััะฒัะตั** โ ะทะฐะณััะทะบะฐ ัะฐะนะปะพะฒ ะฒ Supabase Storage ะฟะฐะดะฐะตั ั ะพัะธะฑะบะพะน, ะธ ะผะฐััะธะฒ `media_urls` ะพััะฐัััั ะฟััััะผ `[]`
2. **ะะฐะณะพะปะพะฒะพะบ "๐ ะัะตะฒัั ะฒะฐัะตะน ัะตะบะปะฐะผั:"** โ ะดะพะฑะฐะฒะปัะตััั ะฒ edge function, ะฟะพะปัะทะพะฒะฐัะตะปั ัะพัะตั ะตะณะพ ัะฑัะฐัั

### ะงัะพ ะฝัะถะฝะพ ัะดะตะปะฐัั

| ะจะฐะณ | ะะตะนััะฒะธะต | ะคะฐะนะป/ะะตัััั |
|-----|----------|-------------|
| 1 | ะกะพะทะดะฐัั storage bucket `campaign-images` | SQL ะผะธะณัะฐัะธั |
| 2 | ะะฐัััะพะธัั RLS ะฟะพะปะธัะธะบะธ ะดะปั bucket | SQL ะผะธะณัะฐัะธั |
| 3 | ะฃะฑัะฐัั ะทะฐะณะพะปะพะฒะพะบ ะธะท ัะตะบััะฐ ะฟัะตะฒัั | `send-campaign-preview/index.ts` |

---

### 1. ะกะพะทะดะฐะฝะธะต Storage Bucket

```sql
-- ะกะพะทะดะฐัั bucket ะดะปั ะธะทะพะฑัะฐะถะตะฝะธะน ะบะฐะผะฟะฐะฝะธะน
INSERT INTO storage.buckets (id, name, public)
VALUES ('campaign-images', 'campaign-images', true);

-- ะะฐะทัะตัะธัั ะฐะฒัะพัะธะทะพะฒะฐะฝะฝัะผ ะฟะพะปัะทะพะฒะฐัะตะปัะผ ะทะฐะณััะถะฐัั ัะฐะนะปั
CREATE POLICY "Users can upload campaign images"
ON storage.objects FOR INSERT
TO authenticated
WITH CHECK (bucket_id = 'campaign-images');

-- ะะฐะทัะตัะธัั ะฟัะฑะปะธัะฝัะน ะดะพัััะฟ ะฝะฐ ััะตะฝะธะต
CREATE POLICY "Public read access for campaign images"
ON storage.objects FOR SELECT
TO public
USING (bucket_id = 'campaign-images');

-- ะะฐะทัะตัะธัั ะฒะปะฐะดะตะปััะฐะผ ัะดะฐะปััั ัะฒะพะธ ัะฐะนะปั
CREATE POLICY "Users can delete own campaign images"
ON storage.objects FOR DELETE
TO authenticated
USING (bucket_id = 'campaign-images' AND auth.uid()::text = (storage.foldername(name))[1]);
```

---

### 2. ะะทะผะตะฝะตะฝะธะต Edge Function

**ะขะตะบััะธะน ะบะพะด (ัััะพะบะธ 74-76):**
```typescript
const previewHeader = "๐ <b>ะัะตะฒัั ะฒะฐัะตะน ัะตะบะปะฐะผั:</b>\n\n";
const fullText = previewHeader + text;
```

**ะะพะฒัะน ะบะพะด:**
```typescript
// ะัะฟัะฐะฒะปัะตะผ ัะตะบัั ะฑะตะท ะทะฐะณะพะปะพะฒะบะฐ โ ะบะฐะบ ะฑัะดะตั ะฒัะณะปัะดะตัั ัะตะบะปะฐะผะฐ
const fullText = text;
```

---

### 3. ะะตะทัะปััะฐั ะฟะพัะปะต ะธะทะผะตะฝะตะฝะธะน

ะะพัะปะต ัะพะทะดะฐะฝะธั bucket ะทะฐะณััะทะบะฐ ัะฐะนะปะพะฒ ะฑัะดะตั ัะฐะฑะพัะฐัั:

```text
ะะพะปัะทะพะฒะฐัะตะปั ัะพะทะดะฐัั ะบะฐะผะฟะฐะฝะธั:
1. ะัะฑะธัะฐะตั ัะพัะพ/ะฒะธะดะตะพ โ ะทะฐะณััะถะฐัััั ะฒ Storage
2. ะะพะปััะฐะตั ะผะฐััะธะฒ URL โ ะพัะฟัะฐะฒะปัะตััั ะฒ edge function
3. Bot ะพัะฟัะฐะฒะปัะตั ะฟะพะปัะทะพะฒะฐัะตะปั:
   - ะะตะดะธะฐ (ัะพัะพ/ะฒะธะดะตะพ)
   - ะขะตะบัั ัะตะบะปะฐะผั (ะฑะตะท ะทะฐะณะพะปะพะฒะบะฐ)
   - ะะฝะพะฟะบะฐ (ะตัะปะธ ะตััั)
```

### ะัะธะผะตั ัะพะพะฑัะตะฝะธั ะพั ะฑะพัะฐ (ะฟะพัะปะต ะธัะฟัะฐะฒะปะตะฝะธั)

```text
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ  [ะคะพัะพ ะธะปะธ ะฒะธะดะตะพ]               โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโค
โ  ะะตะบะปะฐะผะฐะฐะฐะฐะฐะฐ ัะตััะพะฒะฐั          โ
โ                                 โ
โ  [ะัะฟะธัั]                       โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
```

ะะตะท ะปะธัะฝะตะณะพ ะทะฐะณะพะปะพะฒะบะฐ โ ัะพัะฝะพ ะบะฐะบ ะฑัะดะตั ะฒัะณะปัะดะตัั ะฒ ะบะฐะฝะฐะปะต.

